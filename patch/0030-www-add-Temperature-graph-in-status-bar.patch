From 68b5c9cf12f1c66ac2e679b1ea8d2ad06ee89428 Mon Sep 17 00:00:00 2001
From: Rokis <ghost1988102@gmail.com>
Date: Sun, 10 May 2020 13:32:34 +0800
Subject: [PATCH 030/122] www: add Temperature graph in status bar.      add
 translation of Internet Traffic(CN & TW).

Signed-off-by: Rokis <ghost1988102@gmail.com>
---
 release/src/router/www/CN.dict                |   5 +-
 release/src/router/www/EN.dict                |   3 +
 release/src/router/www/TW.dict                |   5 +-
 .../router/www/device-map/router_status.asp   | 105 ++++++++++++++++++
 release/src/router/www/index.asp              |   2 +-
 5 files changed, 117 insertions(+), 3 deletions(-)

diff --git a/release/src/router/www/CN.dict b/release/src/router/www/CN.dict
index b4c23cbee0..5229145712 100644
--- a/release/src/router/www/CN.dict
+++ b/release/src/router/www/CN.dict
@@ -750,8 +750,11 @@ Status_Ethernet_Ports=以太网接口
 Status_Ports=接口
 Status_Connection_Status=连接状态
 Status_Unplugged=未插入
+Status_Traffic=网络传输
+Status_Download=下载
+Status_Upload=上传
 Status_CPU=CPU
-Status_Core=Core
+Status_Core=核心
 Status_RAM=RAM
 Status_Used=已使用
 Status_Free=剩余
diff --git a/release/src/router/www/EN.dict b/release/src/router/www/EN.dict
index b128270fde..e590153393 100644
--- a/release/src/router/www/EN.dict
+++ b/release/src/router/www/EN.dict
@@ -750,6 +750,9 @@ Status_Ethernet_Ports=Ethernet Ports
 Status_Ports=Ports
 Status_Connection_Status=Connection Status
 Status_Unplugged=Unplugged
+Status_Traffic=Internet Traffic
+Status_Download=Down
+Status_Upload=UP
 Status_CPU=CPU
 Status_Core=Core
 Status_RAM=RAM
diff --git a/release/src/router/www/TW.dict b/release/src/router/www/TW.dict
index e07fdd901e..bf9dc3174a 100644
--- a/release/src/router/www/TW.dict
+++ b/release/src/router/www/TW.dict
@@ -750,8 +750,11 @@ Status_Ethernet_Ports=乙太網路連接埠
 Status_Ports=連接埠
 Status_Connection_Status=連線狀態
 Status_Unplugged=未插入
+Status_Traffic=網絡傳輸
+Status_Download=下載
+Status_Upload=上傳
 Status_CPU=CPU
-Status_Core=Core
+Status_Core=核心
 Status_RAM=RAM
 Status_Used=已使用
 Status_Free=剩餘
diff --git a/release/src/router/www/device-map/router_status.asp b/release/src/router/www/device-map/router_status.asp
index d81165cf5c..d7b8867409 100755
--- a/release/src/router/www/device-map/router_status.asp
+++ b/release/src/router/www/device-map/router_status.asp
@@ -24,6 +24,14 @@ var core_num = '<%cpu_core_num();%>';
 var array_size = 46;
 var cpu_usage_array = new Array();
 var ram_usage_array = new Array();
+var temperature_array = new Array();
+var temp_array_size = 46;
+for(i=0;i<3;i++){
+	temperature_array[i] = new Array();
+	for(j=0;j<temp_array_size;j++){
+		temperature_array[i][j] = 101;
+	}
+}
 
 var last_rx = 0;
 var last_tx = 0;
@@ -39,6 +47,9 @@ if (qos_enable > 0 && qos_ibw > 0 && qos_obw > 0) {
 	var max_rx = 100 * 1024;
 	var max_tx = 100 * 1024;
 }
+curr_coreTmp_cpu = "<% get_cpu_temperature(); %>";
+curr_coreTmp_2 = "<% sysinfo("temperature.2"); %>".replace("&deg;C", "");
+curr_coreTmp_5 = "<% sysinfo("temperature.5"); %>".replace("&deg;C", "");
 
 
 var color_table = ["#c6dafc", "#7baaf7", "#4285f4", "#3367d6"];
@@ -64,9 +75,11 @@ $(document).ready(function(){
 	initiailzeParameter();
 	genCPUElement();
 	genRAMElement();
+	genTEMPElement();
 	genNETelement();
 	get_ethernet_ports();
 	detect_CPU_RAM();
+	update_coretmp();
 	update_traffic();
 	if(isSupport("ledg")){
 		$("#light_effect_tab").show();
@@ -400,6 +413,48 @@ function detect_CPU_RAM(){
 	}
 }
 
+function update_coretmp(e){
+  $.ajax({
+    url: '/ajax_coretmp.asp',
+    dataType: 'script',
+
+    error: function(xhr){
+		update_coretmp();
+    },
+    success: function(response){
+			render_Temperature(curr_coreTmp_2, curr_coreTmp_5, curr_coreTmp_cpu);
+			setTimeout("update_coretmp();", 2000);
+		}
+  });
+}
+
+function render_Temperature(_coreTemp_2, _coreTemp_5, _cpuTemp){
+	var temp_pt = "";
+	var tmp = 0;
+	var coreTmp = new Array();
+	coreTmp[0] = _coreTemp_2;
+	coreTmp[1] = _coreTemp_5;
+	coreTmp[2] = _cpuTemp;
+
+	$("#temper_2").html(_coreTemp_2 + "°C");
+	$("#temper_5").html(_coreTemp_5 + "°C");
+	$("#temper_cpu").html(_cpuTemp + "°C");
+
+	for(i=0;i<3;i++){
+		temp_pt = "";
+		tmp = Math.max(parseInt(coreTmp[i]), 20);
+		tmp = Math.min(parseInt(coreTmp[i]), 100);
+		temperature_array[i].push(100 - 100*(tmp-20)/80);
+		temperature_array[i].splice(0,1);
+
+		for(j=0;j<temp_array_size;j++){
+			temp_pt += j*6 +","+ temperature_array[i][j] + " ";
+		}
+
+		document.getElementById('temp'+i+'_graph').setAttribute('points', temp_pt);
+	}
+}
+
 function genCPUElement(){
 	var code = '<div class="division-block"><#Status_CPU#></div>';
 	code += '<div>';
@@ -595,6 +650,55 @@ function get_ethernet_ports() {
 	});
 }
 
+function genTEMPElement() {
+	var code = '<div class="division-block"><#Temperatures#></div>';
+	code += '<div>';
+	code += '<div>';
+	code += '<div class="display-flex flex-a-center ram-content">';
+	code += '<div class="ram-text-width">2.4 GHz</div>';
+	code += '<div class="ram-text-width">5 GHz</div>';
+	code += '<div class="ram-text-width">CPU</div>';
+	code += '</div>';
+	code += '<div class="display-flex flex-a-center ram-content">';
+	code += '<div id="temper_2" class="ram-text-width" style="color:#FF9000;"></div>';
+	code += '<div id="temper_5" class="ram-text-width" style="color:#33CCFF;"></div>';
+	code += '<div id="temper_cpu" class="ram-text-width" style="color:#00FF33;"></div>';
+	code += '</div>';
+	code += '</div>';
+
+	code += '<svg class="svg-block" width="100%" height="100px">';
+	code += '<g>';
+	code += '<line stroke-width="1" stroke-opacity="1" stroke="rgb(255,255,255)" x1="0" y1="0%" x2="100%" y2="0%" />';
+	code += '<line stroke-width="1" stroke-opacity="0.2" stroke="rgb(255,255,255)" x1="0" y1="25%" x2="100%" y2="25%" />';
+	code += '<line stroke-width="1" stroke-opacity="0.2" stroke="rgb(255,255,255)" x1="0" y1="50%" x2="100%" y2="50%" />';
+	code += '<line stroke-width="1" stroke-opacity="0.2" stroke="rgb(255,255,255)" x1="0" y1="75%" x2="100%" y2="75%" />';
+	code += '<line stroke-width="1" stroke-opacity="1" stroke="rgb(255,255,255)" x1="0" y1="100%" x2="100%" y2="100%" />';
+	code += '</g>';
+	code += '<g>';
+	code += '<text font-family="Verdana" fill="#FFFFFF" font-size="8" x="0" y="98%">20°C</text>';
+	code += '<text font-family="Verdana" fill="#FFFFFF" font-size="8" x="0" y="80%">40°C</text>';
+	code += '<text font-family="Verdana" fill="#FFFFFF" font-size="8" x="0" y="55%">60°C</text>';
+	code += '<text font-family="Verdana" fill="#FFFFFF" font-size="8" x="0" y="30%">80°C</text>';
+	code += '<text font-family="Verdana" fill="#FFFFFF" font-size="8" x="0" y="11%">100°C</text>';
+	code += '</g>';
+	code += '<line stroke-width="1" stroke-opacity="1" stroke="rgb(0,0,121)" x1="0" y1="0%" x2="0" y2="100%" />';
+	code += '<line stroke-width="1" stroke-opacity="0.3" stroke="rgb(40,255,40)" x1="11%" y1="0%" x2="11%" y2="100%" />';
+	code += '<line stroke-width="1" stroke-opacity="0.3" stroke="rgb(40,255,40)" x1="22%" y1="0%" x2="22%" y2="100%" />';
+	code += '<line stroke-width="1" stroke-opacity="0.3" stroke="rgb(40,255,40)" x1="33%" y1="0%" x2="33%" y2="100%" />';
+	code += '<line stroke-width="1" stroke-opacity="0.3" stroke="rgb(40,255,40)" x1="44%" y1="0%" x2="44%" y2="100%" />';
+	code += '<line stroke-width="1" stroke-opacity="0.3" stroke="rgb(40,255,40)" x1="55%" y1="0%" x2="55%" y2="100%" />';
+	code += '<line stroke-width="1" stroke-opacity="0.3" stroke="rgb(40,255,40)" x1="66%" y1="0%" x2="66%" y2="100%" />';
+	code += '<line stroke-width="1" stroke-opacity="0.3" stroke="rgb(40,255,40)" x1="77%" y1="0%" x2="77%" y2="100%" />';
+	code += '<line stroke-width="1" stroke-opacity="0.3" stroke="rgb(40,255,40)" x1="88%" y1="0%" x2="88%" y2="100%" />';
+	code += '<line stroke-width="1" stroke-opacity="1" stroke="rgb(0,0,121)"   x1="100%" y1="0%" x2="100%" y2="100%" />';
+	code += '<polyline id="temp0_graph" class="svg-line" style="stroke:#FF9000;" points=""></polyline>';
+	code += '<polyline id="temp1_graph" class="svg-line" style="stroke:#33CCFF;" points=""></polyline>';
+	code += '<polyline id="temp2_graph" class="svg-line" style="stroke:#00FF33;" points=""></polyline>';
+	code += '</svg>';
+
+	$('#temp_field').html(code);
+}
+
 function switchTab(id){
 	var obj = {
 		'wireless_tab': 'router.asp',
@@ -619,6 +723,7 @@ function switchTab(id){
 	<div id="net_field" class="unit-block"></div>
 	<div id="cpu_field" class="unit-block"></div>
 	<div id="ram_field" class="unit-block"></div>
+	<div id="temp_field" class="unit-block"></div>
 	<div id="phy_ports" class="unit-block"></div>
 	<div id="led_field" class="unit-block" style="display:none"></div>
 	<div id='hw_information_field' class="unit-block"></div>
diff --git a/release/src/router/www/index.asp b/release/src/router/www/index.asp
index c1044ffa4a..97502cf524 100644
--- a/release/src/router/www/index.asp
+++ b/release/src/router/www/index.asp
@@ -2535,7 +2535,7 @@ function notice_apply(){
 							<div id="helpname" style="padding-top:10px;font-size:16px;"></div>
 						</div>							
 						<div class="NM_radius_bottom_container">
-							<iframe id="statusframe" class="NM_radius_bottom" style="display:none;margin-left:0px;height:760px;width:320px;\9" name="statusframe" frameborder="0"></iframe>
+							<iframe id="statusframe" class="NM_radius_bottom" style="display:none;margin-left:0px;height:880px;width:320px;\9" name="statusframe" frameborder="0"></iframe>
 						</div>
 				
 						<script>
-- 
2.25.1

