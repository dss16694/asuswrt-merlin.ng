From 9454a0893fda9f8f46c35512a9fc5f3d9bf1e724 Mon Sep 17 00:00:00 2001
From: Rokis <ghost1988102@gmail.com>
Date: Sun, 24 May 2020 20:34:58 +0800
Subject: [PATCH 033/122] cfe: fix get stuck after flash, now reboot normally. 
     "make clean" will remove trx file now.

Signed-off-by: Rokis <ghost1988102@gmail.com>
---
 release/src-rt-7.14.114.x/src/cfe/Makefile          | 4 ++++
 release/src-rt-7.14.114.x/src/cfe/cfe/ui/ui_flash.c | 6 +++---
 2 files changed, 7 insertions(+), 3 deletions(-)

diff --git a/release/src-rt-7.14.114.x/src/cfe/Makefile b/release/src-rt-7.14.114.x/src/cfe/Makefile
index a0788c5a83..e9a4dbcc50 100644
--- a/release/src-rt-7.14.114.x/src/cfe/Makefile
+++ b/release/src-rt-7.14.114.x/src/cfe/Makefile
@@ -2,3 +2,7 @@ all::
 
 %::
 	make -C build/broadcom/bcm947xx $@
+
+clean:
+	rm -rf cfe_*.bin
+	make clean -C build/broadcom/bcm947xx $@
diff --git a/release/src-rt-7.14.114.x/src/cfe/cfe/ui/ui_flash.c b/release/src-rt-7.14.114.x/src/cfe/cfe/ui/ui_flash.c
index f804e13b0d..7a709623bf 100644
--- a/release/src-rt-7.14.114.x/src/cfe/cfe/ui/ui_flash.c
+++ b/release/src-rt-7.14.114.x/src/cfe/cfe/ui/ui_flash.c
@@ -924,10 +924,10 @@ Open_dev:
         }
 #endif
 		if(!cfe) {
-                	for (i=0; i<6; i++)
+                	//for (i=0; i<6; i++)
 	                       send_rescueack(0x0006, 0x0001);
         	        res = 0;
-                	printf("\nBCM47XX SYSTEM RESET!!!\n\n");
+                	xprintf("\nBCM47XX SYSTEM RESET!!!\n\n");
 	                cfe_close(fh);
         	        ui_docommand("reboot");
 		}
@@ -935,7 +935,7 @@ Open_dev:
         else {
                 ui_showerror(amtcopy,"Failed.");
 		if(!cfe) {
-	                for (i=0; i<6; i++)
+	                //for (i=0; i<6; i++)
         	                send_rescueack(0x0006, 0x0000);
                 	res = CFE_ERR_IOERR;
 		}
-- 
2.25.1

